# Advanced Usage

This guide covers advanced features and techniques for Pears power users.

## Custom Installation Hooks

Hooks allow you to run custom commands before or after installation:

```lua
hooks = {
  pre_install = {
    { command = "echo 'Starting installation...'" },
    { command = "mkdir -p ~/workspace" },
  },
  post_install = {
    { command = "echo 'Installation complete!'" },
    { command = "source ~/.zshrc" },
  },
}
```

## Environment Variables

You can set environment variables for your configuration:

```bash
PEARS_CONFIG=/path/to/custom/pears.lua pears install
PEARS_VERBOSE=1 pears install
PEARS_DRY_RUN=1 pears install
```

## Conditional Configuration

You can make configuration conditional based on the system:

```lua
local config = {
  name = "my_environment",
}

-- Detect operating system
local is_macos = os.getenv("OSTYPE") and os.getenv("OSTYPE"):match("darwin")
local is_linux = os.getenv("OSTYPE") and os.getenv("OSTYPE"):match("linux")

-- Conditional packages
if is_macos then
  config.system = {
    type = "brew",
    packages = {
      { name = "coreutils" },
    }
  }

  config.mac_settings = {
    dock = {
      auto_hide = true,
    }
  }
elseif is_linux then
  config.system = {
    type = "apt",
    packages = {
      { name = "build-essential" },
    }
  }
end

return config
```

## Configuration Templating

You can create reusable configuration templates:

```lua
-- helpers.lua
local helpers = {}

function helpers.brew_packages(packages)
  return {
    type = "brew",
    packages = packages
  }
end

function helpers.pip_packages(packages)
  return {
    type = "pip",
    packages = packages
  }
end

return helpers

-- pears.lua
local helpers = require("helpers")

return {
  name = "dev_environment",

  -- Use helpers to define packages
  system = helpers.brew_packages({
    { name = "git" },
    { name = "neovim" },
  }),

  python = helpers.pip_packages({
    { name = "black" },
    { name = "flake8" },
  }),
}
```

## Custom Package Managers

You can define custom package managers:

```lua
custom_managers = {
  {
    name = "vscode_extensions",
    install_cmd = "code --install-extension",
    update_cmd = "code --install-extension",
    uninstall_cmd = "code --uninstall-extension",
    list_cmd = "code --list-extensions",
    packages = {
      { name = "vscodevim.vim" },
      { name = "ms-python.python" },
    }
  }
}
```

## Advanced macOS Configuration

For advanced macOS settings:

```lua
mac_settings = {
  -- Defaults write commands
  defaults = {
    { domain = "NSGlobalDomain", key = "AppleShowAllExtensions", type = "bool", value = true },
    { domain = "com.apple.dock", key = "tilesize", type = "int", value = 36 },
    { domain = "com.apple.finder", key = "ShowPathbar", type = "bool", value = true },
  },

  -- Script to run for custom macOS configuration
  custom_script = [[
    # Custom macOS script
    sudo pmset -a standbydelay 86400
    sudo nvram SystemAudioVolume=" "
  ]]
}
```

## Scripting with Lua

You can use Lua for more advanced scripting:

```lua
scripts = {
  {
    command = function()
      -- Lua function for complex logic
      local home = os.getenv("HOME")
      local file = io.open(home .. "/.config/my_config", "w")
      if file then
        file:write("# Generated by Pears\n")
        file:write("export MY_VAR=value\n")
        file:close()
      end
      return 0  -- Return exit code
    end,
    description = "Generate custom config file"
  }
}
```

## Performance Tuning

For large configurations:

```lua
-- Enable parallel installation where possible
parallel_install = true

-- Set timeout for operations (in seconds)
timeout = 300

-- Customize retry settings
retry = {
  count = 3,
  delay = 5,
}
```

## Integration with Other Tools

You can integrate Pears with other tools:

```lua
-- Integration with dotfile managers
dotfiles = {
  repo = "https://github.com/dunnoconz/dotfiles.git",
  path = "~/.dotfiles",
  install_cmd = "~/.dotfiles/install.sh",
}

-- Integration with container tools
containers = {
  {
    name = "dev_container",
    type = "docker",
    image = "ubuntu:latest",
    run_cmd = "docker run -it --rm dev_container",
  }
}
```

## Custom Logging

Configure custom logging:

```lua
logging = {
  level = "debug",  -- "debug", "info", "warn", "error"
  file = "~/pears.log",
  format = "detailed",  -- "simple", "detailed", "json"
}
```
